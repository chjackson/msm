<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tables of observed and expected prevalences — prevalence.msm • msm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tables of observed and expected prevalences — prevalence.msm"><meta name="description" content="This provides a rough indication of the goodness of fit of a multi-state
model, by estimating the observed numbers of individuals occupying each
state at a series of times, and comparing these with forecasts from the
fitted model."><meta property="og:description" content="This provides a rough indication of the goodness of fit of a multi-state
model, by estimating the observed numbers of individuals occupying each
state at a series of times, and comparing these with forecasts from the
fitted model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tables of observed and expected prevalences</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msm/blob/master/R/prevalence.R" class="external-link"><code>R/prevalence.R</code></a></small>
      <div class="d-none name"><code>prevalence.msm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This provides a rough indication of the goodness of fit of a multi-state
model, by estimating the observed numbers of individuals occupying each
state at a series of times, and comparing these with forecasts from the
fitted model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prevalence.msm</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  timezero <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  initstates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariates <span class="op">=</span> <span class="st">"population"</span>,</span>
<span>  misccovariates <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  piecewise.times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  piecewise.covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"normal"</span>, <span class="st">"bootstrap"</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"midpoint"</span><span class="op">)</span>,</span>
<span>  censtime <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A fitted multi-state model produced by <code><a href="msm.html">msm</a></code>.</p></dd>


<dt id="arg-times">times<a class="anchor" aria-label="anchor" href="#arg-times"></a></dt>
<dd><p>Series of times at which to compute the observed and expected
prevalences of states.</p></dd>


<dt id="arg-timezero">timezero<a class="anchor" aria-label="anchor" href="#arg-timezero"></a></dt>
<dd><p>Initial time of the Markov process. Expected values are
forecasted from here. Defaults to the minimum of the observation times given
in the data.</p></dd>


<dt id="arg-initstates">initstates<a class="anchor" aria-label="anchor" href="#arg-initstates"></a></dt>
<dd><p>Optional vector of the same length as the number of
states. Gives the numbers of individuals occupying each state at the initial
time, to be used for forecasting expected prevalences.  The default is those
observed in the data.  These should add up to the actual number of people in
the study at the start.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>Covariate values for which to forecast expected state
occupancy.  With the default <code>covariates="population"</code>, expected
prevalences are produced by summing model predictions over the covariates
observed in the original data, for a fair comparison with the observed
prevalences.  This may be slow, particularly with continuous covariates.</p>
<p>Predictions for fixed covariates can be obtained by supplying covariate
values in the standard way, as in <code><a href="qmatrix.msm.html">qmatrix.msm</a></code>. Therefore if
<code>covariates="population"</code> is too slow, using the mean observed values
through <code>covariates="mean"</code> may give a reasonable approximation.</p>
<p>This argument is ignored if <code>piecewise.times</code> is specified. If there
are a mixture of time-constant and time-dependent covariates, then the
values for all covariates should be supplied in <code>piecewise.covariates</code>.</p></dd>


<dt id="arg-misccovariates">misccovariates<a class="anchor" aria-label="anchor" href="#arg-misccovariates"></a></dt>
<dd><p>(Misclassification models only) Values of covariates
on the misclassification probability matrix for converting expected true to
expected misclassified states.  Ignored if <code>covariates="population"</code>,
otherwise defaults to the mean values of the covariates in the data set.</p></dd>


<dt id="arg-piecewise-times">piecewise.times<a class="anchor" aria-label="anchor" href="#arg-piecewise-times"></a></dt>
<dd><p>Times at which piecewise-constant intensities change.
See <code><a href="pmatrix.piecewise.msm.html">pmatrix.piecewise.msm</a></code> for how to specify this.  Ignored if
<code>covariates="population"</code>.  This is only required for
time-inhomogeneous models specified using explicit time-dependent
covariates, and should not be used for models specified using "pci".</p></dd>


<dt id="arg-piecewise-covariates">piecewise.covariates<a class="anchor" aria-label="anchor" href="#arg-piecewise-covariates"></a></dt>
<dd><p>Covariates on which the piecewise-constant
intensities depend. See <code><a href="pmatrix.piecewise.msm.html">pmatrix.piecewise.msm</a></code> for how to
specify this. Ignored if <code>covariates="population"</code>.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>If <code>"normal"</code>, then calculate a confidence interval for the
expected prevalences by simulating <code>B</code> random vectors from the
asymptotic multivariate normal distribution implied by the maximum
likelihood estimates (and covariance matrix) of the log transition
intensities and covariate effects, then calculating the expected prevalences
for each replicate.</p>
<p>If <code>"bootstrap"</code> then calculate a confidence interval by non-parametric
bootstrap refitting.  This is 1-2 orders of magnitude slower than the
<code>"normal"</code> method, but is expected to be more accurate. See
<code><a href="boot.msm.html">boot.msm</a></code> for more details of bootstrapping in <span class="pkg">msm</span>.</p>
<p>If <code>"none"</code> (the default) then no confidence interval is calculated.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Width of the symmetric confidence interval, relative to 1</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of bootstrap replicates</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Number of cores to use for bootstrapping using parallel
processing. See <code><a href="boot.msm.html">boot.msm</a></code> for more details.</p></dd>


<dt id="arg-interp">interp<a class="anchor" aria-label="anchor" href="#arg-interp"></a></dt>
<dd><p>Suppose an individual was observed in states \(S_{r-1}\) and
\(S_r\) at two consecutive times \(t_{r-1}\) and \(t_r\), and we want
to estimate 'observed' prevalences at a time \(t\) between \(t_{r-1}\)
and \(t_r\).</p>
<p>If <code>interp="start"</code>, then individuals are assumed to be in state
\(S_{r-1}\) at time \(t\), the same state as they were at \(t_{r-1}\).</p>
<p>If <code>interp="midpoint"</code> then if \(t &lt;= (t_{r-1} + t_r) / 2\), the
midpoint of \(t_{r-1}\) and \(t_r\), the state at \(t\) is assumed to
be \(S_{r-1}\), otherwise \(S_{r}\). This is generally more reasonable
for "progressive" models.</p></dd>


<dt id="arg-censtime">censtime<a class="anchor" aria-label="anchor" href="#arg-censtime"></a></dt>
<dd><p>Adjustment to the observed prevalences to account for
limited follow-up in the data.</p>
<p>If the time is greater than <code>censtime</code> and the patient has reached an
absorbing state, then that subject will be removed from the risk set.  For
example, if patients have died but would only have been observed up to this
time, then this avoids overestimating the proportion of people who are dead
at later times.</p>
<p>This can be supplied as a single value, or as a vector with one element per
subject (after any <code>subset</code> has been taken), in the same order as the
original data.  This vector also only includes subjects with complete data,
thus it excludes for example subjects with only one observation (thus no
observed transitions), and subjects for whom every observation has missing
values.  (Note, to help construct this, the complete data used for the model
fit can be accessed with <code>model.frame(x)</code>, where <code>x</code> is the fitted
model object)</p>
<p>This is ignored if it is less than the subject's maximum observation time.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>Subset of subjects to calculate observed prevalences for.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Generate a plot of observed against expected prevalences. See
<code><a href="plot.prevalence.msm.html">plot.prevalence.msm</a></code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments to pass to <code><a href="plot.prevalence.msm.html">plot.prevalence.msm</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of matrices, with components:</p>
<dl><dt>Observed</dt>
<dd><p>Table of observed numbers of individuals in each state at
each time</p></dd>


<dt>Observed percentages</dt>
<dd><p>Corresponding percentage of the individuals at
risk at each time.</p></dd>


<dt>Expected</dt>
<dd><p>Table of corresponding expected numbers.</p></dd>


<dt>Expected percentages</dt>
<dd><p>Corresponding percentage of the individuals at
risk at each time.</p></dd>


</dl><p>Or if <code>ci.boot = TRUE</code>, the component <code>Expected</code> is a list with
components <code>estimates</code> and <code>ci</code>.<br><code>estimates</code> is a matrix
of the expected prevalences, and <code>ci</code> is a list of two matrices,
containing the confidence limits. The component <code>Expected percentages</code>
has a similar format.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The fitted transition probability matrix is used to forecast expected
prevalences from the state occupancy at the initial time.  To produce the
expected number in state \(j\) at time \(t\) after the start, the number
of individuals under observation at time \(t\) (including those who have
died, but not those lost to follow-up) is multiplied by the product of the
proportion of individuals in each state at the initial time and the
transition probability matrix in the time interval \(t\).  The proportion
of individuals in each state at the "initial" time is estimated, if
necessary, in the same way as the observed prevalences.</p>
<p>For misclassification models (fitted using an <code>ematrix</code>), this aims to
assess the fit of the full model for the <em>observed</em> states.  That is,
the combined Markov progression model for the true states and the
misclassification model. Thus, expected prevalences of <em>true</em> states
are estimated from the assumed proportion occupying each state at the
initial time using the fitted transition probabiliy matrix. The vector of
expected prevalences of true states is then multiplied by the fitted
misclassification probability matrix to obtain the expected prevalences of
<em>observed</em> states.</p>
<p>For general hidden Markov models, the observed state is taken to be the
predicted underlying state from the Viterbi algorithm
(<code><a href="viterbi.msm.html">viterbi.msm</a></code>).  The goodness of fit of these states to the
underlying Markov model is tested.</p>
<p>In any model, if there are censored states, then these are replaced by
imputed values of highest probability from the Viterbi algorithm in order to
calculate the observed state prevalences.</p>
<p>For an example of this approach, see Gentleman <em>et al.</em> (1994).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gentleman, R.C., Lawless, J.F., Lindsey, J.C. and Yan, P.
Multi-state Markov models for analysing incomplete disease history data with
illustrations for HIV disease.  <em>Statistics in Medicine</em> (1994) 13(3):
805–821.</p>
<p>Titman, A.C., Sharples, L. D.  Model diagnostics for multi-state models.
<em>Statistical Methods in Medical Research</em> (2010) 19(6):621-651.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="msm.html">msm</a></code>, <code><a href="summary.msm.html">summary.msm</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

