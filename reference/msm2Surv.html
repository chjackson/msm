<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert data for `msm' to data for `survival', `mstate' or `flexsurv' analysis — msm2Surv • msm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert data for `msm' to data for `survival', `mstate' or `flexsurv' analysis — msm2Surv"><meta name="description" content="Converts longitudinal data for a msm model fit, where
observations represent the exact transition times of the process, to
counting process data.  This enables, for example, flexible parametric
multi-state models to be fitted with flexsurvreg
from the flexsurv package, or semiparametric models to be implemented
with coxph and the mstate package."><meta property="og:description" content="Converts longitudinal data for a msm model fit, where
observations represent the exact transition times of the process, to
counting process data.  This enables, for example, flexible parametric
multi-state models to be fitted with flexsurvreg
from the flexsurv package, or semiparametric models to be implemented
with coxph and the mstate package."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Convert data for `msm' to data for `survival', `mstate' or `flexsurv' analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msm/blob/v1.8.1/R/mstate.R" class="external-link"><code>R/mstate.R</code></a></small>
      <div class="d-none name"><code>msm2Surv.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Converts longitudinal data for a <code><a href="msm.html">msm</a></code> model fit, where
observations represent the exact transition times of the process, to
counting process data.  This enables, for example, flexible parametric
multi-state models to be fitted with <code><a href="http://chjackson.github.io/flexsurv-dev/reference/flexsurvreg.html" class="external-link">flexsurvreg</a></code>
from the <span class="pkg">flexsurv</span> package, or semiparametric models to be implemented
with <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> and the <span class="pkg">mstate</span> package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">msm2Surv</span><span class="op">(</span><span class="va">data</span>, <span class="va">subject</span>, <span class="va">time</span>, <span class="va">state</span>, covs <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">Q</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame in the format expected by a <code><a href="msm.html">msm</a></code> model
fit with <code>exacttimes=TRUE</code> or all <code>obstype=2</code>.  Each row
represents an observation of a state, and the time variable contains the
exact and complete transition times of the underlying process.  This is
explained in more detail in the help page for <code><a href="msm.html">msm</a></code>, section
<code>obstype=2</code>.</p></dd>


<dt id="arg-subject">subject<a class="anchor" aria-label="anchor" href="#arg-subject"></a></dt>
<dd><p>Name of the subject ID in the data (character format, i.e.
quoted).</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>Name of the time variable in the data (character).</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>Name of the state variable in the data (character).</p></dd>


<dt id="arg-covs">covs<a class="anchor" aria-label="anchor" href="#arg-covs"></a></dt>
<dd><p>Vector of covariate names to carry through (character).  If not
supplied, this is taken to be all remaining variables in the data.</p></dd>


<dt id="arg-q">Q<a class="anchor" aria-label="anchor" href="#arg-q"></a></dt>
<dd><p>Transition intensity matrix.  This should have number of rows and
number of columns both equal to the number of states.  If an instantaneous
transition is not allowed from state \(r\) to state \(s\), then <code>Q</code>
should have \((r,s)\) entry 0, otherwise it should be non-zero.  The
diagonal entries are ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame of class <code>"msdata"</code>, with rows representing
observed or censored transitions.  There will be one row for each observed
transition in the original data, and additional rows for every potential
transition that could have occurred out of each observed state.</p>
<p>The data frame will have columns called:</p>
<dl><dt>id</dt>
<dd><p>Subject ID</p></dd>
 <dt>from</dt>
<dd><p>Starting state of the transition</p></dd>

<dt>to</dt>
<dd><p>Finishing state of the transition</p></dd>
 <dt>Tstart</dt>
<dd><p>The starting time
of the transition</p></dd>
 <dt>Tstop</dt>
<dd><p>The finishing time of the transition</p></dd>

<dt>time</dt>
<dd><p>The time difference = <code>Tstop</code> - <code>Tstart</code></p></dd>

<dt>status</dt>
<dd><p>Event or censoring indicator, with 1 indicating an observed
transition, and 0 indicating censoring</p></dd>
 <dt>trans</dt>
<dd><p>Transition number</p></dd>


</dl><p>and any remaining columns will represent covariates.  Any covariates whose
names clash with the standard variables in the returned data (<code>"id"</code>,
<code>"from"</code>, <code>"to"</code>, <code>"Tstart"</code>, <code>"Tstop"</code>, <code>"time"</code>,
<code>"status"</code> or <code>"trans"</code>) have <code>".2"</code> appended to their names.</p>
<p>The transition matrix in <span class="pkg">mstate</span> format is stored in the <code>trans</code>
attribute of the returned object.  See the example code below.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For example, if the data supplied to <code><a href="msm.html">msm</a></code> look like this:</p>
<table class="table table"><tr><td><code>subj</code></td><td><code>days</code></td><td><code>status</code></td><td><code>age</code></td><td><code>treat</code></td></tr><tr><td>1</td><td>0</td><td>1</td><td>66</td><td>1</td></tr><tr><td>1</td><td>27</td><td>2</td><td>66</td><td>1</td></tr><tr><td>1</td><td>75</td><td>3</td><td>66</td><td>1</td></tr><tr><td>1</td><td>97</td><td>4</td><td>66</td><td>1</td></tr><tr><td>1</td><td>1106</td><td>4</td><td>69</td><td>1</td></tr><tr><td>2</td><td>0</td><td>1</td><td>49</td><td>0</td></tr><tr><td>2</td><td>90</td><td>2</td><td>49</td><td>0</td></tr><tr><td>2</td><td>1037</td><td>2</td><td>51</td><td>0</td></tr></table><p>then the output of <code>msm2Surv</code> will be a data frame looking like
this:</p>
<table class="table table"><tr><td><code>id</code></td><td><code>from</code></td><td><code>to</code></td><td><code>Tstart</code></td><td><code>Tstop</code></td><td><code>time</code></td><td><code>status</code></td><td><code>age</code></td><td><code>treat</code></td><td><code>trans</code></td><td>1</td></tr><tr><td>1</td><td>2</td><td>0</td><td>27</td><td>27</td><td>1</td><td>66</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>4</td><td>0</td><td>27</td><td>27</td><td>0</td><td>66</td><td>1</td><td>2</td><td>1</td><td>2</td><td>3</td></tr><tr><td>27</td><td>75</td><td>48</td><td>1</td><td>66</td><td>1</td><td>3</td><td>1</td><td>2</td><td>4</td><td>27</td></tr><tr><td>75</td><td>48</td><td>0</td><td>66</td><td>1</td><td>4</td><td>1</td><td>3</td><td>4</td><td>75</td><td>97</td></tr><tr><td>22</td><td>1</td><td>69</td><td>1</td><td>5</td><td>2</td><td>1</td><td>2</td><td>0</td><td>90</td><td>90</td></tr><tr><td>1</td><td>49</td><td>0</td><td>1</td><td>2</td><td>1</td><td>4</td><td>0</td><td>90</td><td>90</td><td>0</td></tr><tr><td>49</td><td>0</td><td>2</td><td>2</td><td>2</td><td>3</td><td>90</td><td>1037</td><td>947</td><td>0</td><td>49</td></tr><tr><td>0</td><td>3</td><td>2</td><td>2</td><td>4</td><td>90</td><td>1037</td><td>947</td><td>0</td><td>49</td><td>0</td></tr></table><p>At 27 days, subject 1 is observed to move from state 1 to state 2 (first
row, status 1), which means that their potential transition from state 1 to
state 4 is censored (second row, status 0).</p>
<p>See the <span class="pkg">mstate</span> package and the references below for more details of
this data format and using it for semi-parametric multi-state modelling.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Putter H, Fiocco M, Geskus RB (2007). Tutorial in biostatistics:
Competing risks and multi-state models. <em>Statistics in Medicine</em> 26:
2389-2430.</p>
<p>Liesbeth C. de Wreede, Marta Fiocco, Hein Putter (2011). <span class="pkg">mstate</span>: An R
Package for the Analysis of Competing Risks and Multi-State Models.
<em>Journal of Statistical Software</em>, 38(7), 1-30.</p>
<p>Jackson, C. H. (2014). flexsurv: Flexible parametric survival and
multi-state models.  R package version 0.5.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/mstate/man/msprep.html" class="external-link">msprep</a></code>, in <span class="pkg">mstate</span>, which produces data
in a similar format, given data in "wide" format with one row per subject.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">msmdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> subj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">27</span>, <span class="fl">75</span>, <span class="fl">97</span>, <span class="fl">1106</span>, <span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">1037</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="fl">66</span>, <span class="fl">66</span>, <span class="fl">66</span>, <span class="fl">69</span>, <span class="fl">49</span>, <span class="fl">49</span>, <span class="fl">51</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># transitions only allowed to next state up or state 4</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">msm2Surv</span><span class="op">(</span>data<span class="op">=</span><span class="va">msmdat</span>, subject<span class="op">=</span><span class="st">"subj"</span>, time<span class="op">=</span><span class="st">"days"</span>, state<span class="op">=</span><span class="st">"status"</span>, </span></span>
<span class="r-in"><span>         Q<span class="op">=</span><span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An object of class 'msdata'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id from to Tstart Tstop time status age treat trans</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1    1  2      0    27   27      1  66     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1    1  4      0    27   27      0  66     1     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1    2  3     27    75   48      1  66     1     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  1    2  4     27    75   48      0  66     1     4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  1    3  4     75    97   22      1  66     1     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2    1  2      0    90   90      1  49     0     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  2    1  4      0    90   90      0  49     0     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2    2  3     90  1037  947      0  49     0     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  2    2  4     90  1037  947      0  49     0     4</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"trans"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     to</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> from  1  2  3  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 NA  1 NA  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2 NA NA  3  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3 NA NA NA  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4 NA NA NA NA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

