<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Extract the estimated transition probability matrix from a fitted
non-time-homogeneous multi-state model for a given time interval.  This is a
generalisation of pmatrix.msm to models with time-dependent
covariates.  Note that pmatrix.msm is sufficient to calculate
transition probabilities for time-inhomogeneous models fitted using the
pci argument to msm."><title>Transition probability matrix for processes with piecewise-constant
intensities — pmatrix.piecewise.msm • msm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transition probability matrix for processes with piecewise-constant
intensities — pmatrix.piecewise.msm"><meta property="og:description" content="Extract the estimated transition probability matrix from a fitted
non-time-homogeneous multi-state model for a given time interval.  This is a
generalisation of pmatrix.msm to models with time-dependent
covariates.  Note that pmatrix.msm is sufficient to calculate
transition probabilities for time-inhomogeneous models fitted using the
pci argument to msm."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">msm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/chjackson/msm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transition probability matrix for processes with piecewise-constant
intensities</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msm/blob/HEAD/R/outputs.R" class="external-link"><code>R/outputs.R</code></a></small>
      <div class="d-none name"><code>pmatrix.piecewise.msm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extract the estimated transition probability matrix from a fitted
non-time-homogeneous multi-state model for a given time interval.  This is a
generalisation of <code><a href="pmatrix.msm.html">pmatrix.msm</a></code> to models with time-dependent
covariates.  Note that <code><a href="pmatrix.msm.html">pmatrix.msm</a></code> is sufficient to calculate
transition probabilities for time-inhomogeneous models fitted using the
<code>pci</code> argument to <code><a href="msm.html">msm</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pmatrix.piecewise.msm</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">t1</span>,</span>
<span>  <span class="va">t2</span>,</span>
<span>  <span class="va">times</span>,</span>
<span>  <span class="va">covariates</span>,</span>
<span>  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"normal"</span>, <span class="st">"bootstrap"</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  qlist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>A fitted multi-state model, as returned by <code><a href="msm.html">msm</a></code>. This
should be a non-homogeneous model, whose transition intensity matrix depends
on a time-dependent covariate.</p></dd>


<dt>t1</dt>
<dd><p>The start of the time interval to estimate the transition
probabilities for.</p></dd>


<dt>t2</dt>
<dd><p>The end of the time interval to estimate the transition
probabilities for.</p></dd>


<dt>times</dt>
<dd><p>Cut points at which the transition intensity matrix changes.</p></dd>


<dt>covariates</dt>
<dd><p>A list with number of components one greater than the
length of <code>times</code>.  Each component of the list is specified in the same
way as the <code>covariates</code> argument to <code><a href="pmatrix.msm.html">pmatrix.msm</a></code>.  The
components correspond to the covariate values in the intervals</p>
<p><code>(t1, times[1]], (times[1], times[2]], ..., (times[length(times)], t2]</code></p>
<p>(assuming that all elements of <code>times</code> are in the interval <code>(t1,
t2)</code>).</p></dd>


<dt>ci</dt>
<dd><p>If <code>"normal"</code>, then calculate a confidence interval for the
transition probabilities by simulating <code>B</code> random vectors from the
asymptotic multivariate normal distribution implied by the maximum
likelihood estimates (and covariance matrix) of the log transition
intensities and covariate effects, then calculating the resulting transition
probability matrix for each replicate.</p>
<p>If <code>"bootstrap"</code> then calculate a confidence interval by non-parametric
bootstrap refitting.  This is 1-2 orders of magnitude slower than the
<code>"normal"</code> method, but is expected to be more accurate. See
<code><a href="boot.msm.html">boot.msm</a></code> for more details of bootstrapping in <span class="pkg">msm</span>.</p>
<p>If <code>"none"</code> (the default) then no confidence interval is calculated.</p></dd>


<dt>cl</dt>
<dd><p>Width of the symmetric confidence interval, relative to 1.</p></dd>


<dt>B</dt>
<dd><p>Number of bootstrap replicates, or number of normal simulations
from the distribution of the MLEs</p></dd>


<dt>cores</dt>
<dd><p>Number of cores to use for bootstrapping using parallel
processing. See <code><a href="boot.msm.html">boot.msm</a></code> for more details.</p></dd>


<dt>qlist</dt>
<dd><p>A list of transition intensity matrices, of length one greater
than the length of <code>times</code>.  Either this or a fitted model <code>x</code>
must be supplied.  No confidence intervals are available if (just)
<code>qlist</code> is supplied.</p></dd>


<dt>...</dt>
<dd><p>Optional arguments to be passed to <code><a href="MatrixExp.html">MatrixExp</a></code> to
control the method of computing the matrix exponential.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The matrix of estimated transition probabilities \(P(t)\) for the
time interval <code>[t1, tn]</code>.  That is, the probabilities of occupying
state \(s\) at time \(t_n\) conditionally on occupying state \(r\)</p>


<p>at time \(t_1\).  Rows correspond to "from-state" and columns to
"to-state".</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Suppose a multi-state model has been fitted, in which the transition
intensity matrix \(Q(x(t))\) is modelled in terms of time-dependent
covariates \(x(t)\).  The transition probability matrix \(P(t_1,
t_n)\) for the time interval \((t_1, \)\(
t_n)\) cannot be calculated from the estimated intensity matrix as
\(\exp((t_n - t_1) Q)\), because \(Q\) varies within
the interval \(t_1, t_n\).  However, if the covariates are
piecewise-constant, or can be approximated as piecewise-constant, then we
can calculate \(P(t_1, t_n)\) by multiplying together
individual matrices \(P(t_i, \)\( t_{i+1}) = \exp((t_{i+1} - t_i) Q)\), calculated over intervals where Q is constant:</p>
<p>$$P(t_1, t_n) = P(t_1, t_2) P(t_2, t_3)\ldots P(t_{n-1}, $$$$ t_n)$$</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pmatrix.msm.html">pmatrix.msm</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## In a clinical study, suppose patients are given a placebo in the</span></span></span>
<span class="r-in"><span><span class="co">## first 5 weeks, then they begin treatment 1 at 5 weeks, and</span></span></span>
<span class="r-in"><span><span class="co">## a combination of treatments 1 and 2 from 10 weeks.</span></span></span>
<span class="r-in"><span><span class="co">## Suppose a multi-state model x has been fitted for the patients'</span></span></span>
<span class="r-in"><span><span class="co">## progress, with treat1 and treat2 as time dependent covariates.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Cut points for when treatment covariate changes</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Indicators for which treatments are active in the four intervals</span></span></span>
<span class="r-in"><span><span class="co">## defined by the three cut points</span></span></span>
<span class="r-in"><span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>treat1<span class="op">=</span><span class="fl">0</span>, treat2<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>treat1<span class="op">=</span><span class="fl">0</span>, treat2<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>treat1<span class="op">=</span><span class="fl">1</span>, treat2<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>treat1<span class="op">=</span><span class="fl">1</span>, treat2<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate transition probabilities from the start of the study to 15 weeks</span></span></span>
<span class="r-in"><span><span class="fu">pmatrix.piecewise.msm</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span>, <span class="fl">15</span>, <span class="va">times</span>, <span class="va">covariates</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

