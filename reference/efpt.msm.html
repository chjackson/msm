<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Expected first passage time — efpt.msm • msm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Expected first passage time — efpt.msm"><meta name="description" content="Expected time until first reaching a particular state or set of states in a
Markov model."><meta property="og:description" content="Expected time until first reaching a particular state or set of states in a
Markov model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Expected first passage time</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msm/blob/master/R/efpt.R" class="external-link"><code>R/efpt.R</code></a></small>
      <div class="d-none name"><code>efpt.msm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Expected time until first reaching a particular state or set of states in a
Markov model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">efpt.msm</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  qmatrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">tostate</span>,</span>
<span>  start <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"normal"</span>, <span class="st">"bootstrap"</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A fitted multi-state model, as returned by <code><a href="msm.html">msm</a></code>.</p></dd>


<dt id="arg-qmatrix">qmatrix<a class="anchor" aria-label="anchor" href="#arg-qmatrix"></a></dt>
<dd><p>Instead of <code>x</code>, you can simply supply a transition
intensity matrix in <code>qmatrix</code>.</p></dd>


<dt id="arg-tostate">tostate<a class="anchor" aria-label="anchor" href="#arg-tostate"></a></dt>
<dd><p>State, or set of states supplied as a vector, for which to
estimate the first passage time into.  Can be integer, or character matched
to the row names of the Q matrix.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>Starting state (integer).  By default (<code>start="all"</code>),
this will return a vector of expected passage times from each state in turn.</p>
<p>Alternatively, this can be used to obtain the expected first passage time
from a <em>set</em> of states, rather than single states.  To achieve this,
<code>state</code> is set to a vector of weights, with length equal to the number
of states in the model.  These weights should be proportional to the
probability of starting in each of the states in the desired set, so that
weights of zero are supplied for other states.  The function will calculate
the weighted average of the expected passage times from each of the
corresponding states.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>Covariate values defining the intensity matrix for the
fitted model <code>x</code>, as supplied to <code><a href="qmatrix.msm.html">qmatrix.msm</a></code>.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>If <code>"normal"</code>, then calculate a confidence interval by
simulating <code>B</code> random vectors from the asymptotic multivariate normal
distribution implied by the maximum likelihood estimates (and covariance
matrix) of the log transition intensities and covariate effects.</p>
<p>If <code>"bootstrap"</code> then calculate a confidence interval by non-parametric
bootstrap refitting.  This is 1-2 orders of magnitude slower than the
<code>"normal"</code> method, but is expected to be more accurate. See
<code><a href="boot.msm.html">boot.msm</a></code> for more details of bootstrapping in <span class="pkg">msm</span>.</p>
<p>If <code>"none"</code> (the default) then no confidence interval is calculated.</p></dd>


<dt id="arg-cl">cl<a class="anchor" aria-label="anchor" href="#arg-cl"></a></dt>
<dd><p>Width of the symmetric confidence interval, relative to 1.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of bootstrap replicates.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Number of cores to use for bootstrapping using parallel
processing. See <code><a href="boot.msm.html">boot.msm</a></code> for more details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments to pass to <code><a href="MatrixExp.html">MatrixExp</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector of expected first passage times, or "hitting times", from
each state to the desired state.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The expected first passage times from each of a set of states
\(\mathbf{i}\) to to the remaining set of states
\(\overline{\mathbf{i}}\) in the state space, for a model with
transition intensity matrix \(Q\), are</p>
<p>$$-Q_{\mathbf{i},\mathbf{i}}^{-1} \mathbf{1}$$</p>
<p>where \(\mathbf{1}\) is a vector of ones, and
\(Q_{\mathbf{i},\mathbf{i}}\) is the square subset of \(Q\)
pertaining to states \(\mathbf{i}\).</p>
<p>It is equal to the sum of mean sojourn times for all states between the
"from" and "to" states in a unidirectional model.  If there is non-zero
chance of reaching an absorbing state before reaching <code>tostate</code>, then
it is infinite.  It is trivially zero if the "from" state equals
<code>tostate</code>.</p>
<p>This function currently only handles time-homogeneous Markov models.  For
time-inhomogeneous models it will assume that \(Q\) equals the average
intensity matrix over all times and observed covariates.  Simulation might
be used to handle time dependence.</p>
<p>Note this is the <em>expectation</em> of first passage time, and the
confidence intervals are CIs for this mean, not predictive intervals for the
first passage time.  The full distribution of the first passage time to a
set of states can be obtained by setting the rows of the intensity matrix
\(Q\) corresponding to that set of states to zero to make a model where
those states are absorbing.  The corresponding transition probability matrix
\(Exp(Qt)\) then gives the probabilities of having hit or passed that
state by a time \(t\) (see the example below). This is implemented in
<code><a href="ppass.msm.html">ppass.msm</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Norris, J. R. (1997) Markov Chains. Cambridge University Press.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sojourn.msm.html">sojourn.msm</a></code>, <code><a href="totlos.msm.html">totlos.msm</a></code>,
<code><a href="boot.msm.html">boot.msm</a></code>.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">twoway4.q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.166</span>, <span class="op">-</span><span class="fl">0.498</span>, <span class="fl">0.166</span>, <span class="fl">0.166</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">efpt.msm</span><span class="op">(</span>qmatrix<span class="op">=</span><span class="va">twoway4.q</span>, tostate<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] Inf Inf   0 Inf</span>
<span class="r-in"><span><span class="co"># given in state 1, expected time to reaching state 3 is infinite</span></span></span>
<span class="r-in"><span><span class="co"># since may die (state 4) before entering state 3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If we remove the death state from the model, EFPTs become finite</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="va">twoway4.q</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">efpt.msm</span><span class="op">(</span>qmatrix<span class="op">=</span><span class="va">Q</span>, tostate<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 14.0241 10.0241  0.0000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose we cannot die or regress while in state 2, can only go to state 3</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="va">twoway4.q</span>; <span class="va">Q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">efpt.msm</span><span class="op">(</span>qmatrix<span class="op">=</span><span class="va">Q</span>, tostate<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]      Inf 6.024096 0.000000      Inf</span>
<span class="r-in"><span><span class="co"># The expected time from 2 to 3 now equals the mean sojourn time in 2.</span></span></span>
<span class="r-in"><span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">Q</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6.024096</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate cumulative distribution of the first passage time</span></span></span>
<span class="r-in"><span><span class="co"># into state 3 for the following three-state model</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="va">twoway4.q</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Q</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Firstly form a model where the desired hitting state is absorbing</span></span></span>
<span class="r-in"><span><span class="va">Q</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="fu"><a href="MatrixExp.html">MatrixExp</a></span><span class="op">(</span><span class="va">Q</span>, t<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4790663 0.6501628 1.0000000</span>
<span class="r-in"><span><span class="fu"><a href="ppass.msm.html">ppass.msm</a></span><span class="op">(</span>qmatrix<span class="op">=</span><span class="va">Q</span>, tot<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]     [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1.0000000 0.917915 0.4790663</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.4819236 1.000000 0.6501628</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.0000000 0.000000 1.0000000</span>
<span class="r-in"><span><span class="co"># Given in state 1 at time 0, P(hit 3 by time 10) = 0.479</span></span></span>
<span class="r-in"><span><span class="fu"><a href="MatrixExp.html">MatrixExp</a></span><span class="op">(</span><span class="va">Q</span>, t<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>  <span class="co"># P(hit 3 by time 50) = 0.98</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9812676 0.9875017 1.0000000</span>
<span class="r-in"><span><span class="fu"><a href="ppass.msm.html">ppass.msm</a></span><span class="op">(</span>qmatrix<span class="op">=</span><span class="va">Q</span>, tot<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]      [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.0 0.9999963 0.9812676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.5 1.0000000 0.9875017</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  0.0 0.0000000 1.0000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

